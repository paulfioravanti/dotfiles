# ~/.tmuxinator/survey_tool_elm.yml

name: survey_tool_elm
root: ~/elm/survey_tool_elm

# Runs before everything. Use it to start daemons etc.
on_project_first_start:
  - asdf local elixir 1.6.4
  - asdf local erlang 20.3.4
  - asdf local nodejs 10.0.0
  - asdf local elm 0.18.0
  # Back end
  - open --background http://localhost:4000/survey_results
  # Front end
  - open --background http://localhost:3000
  # Grip
  - open --background http://localhost:6419
  # Elm coverage
  - open ~/elm/survey_tool_elm/front_end/.coverage/coverage.html

# Runs in each window and pane before window/pane specific commands. Useful for setting up interpreter versions.
# pre_window:

# Specifies (by name or index) which window will be selected on project startup. If not set, the first window is used.
startup_window: editor

windows:
  - editor: vim
  - front_tests:
      root: ~/elm/survey_tool_elm/front_end
      panes:
        # Uses `just` and `watchexec` to run both
        # elm-verify-examples and elm-test when any src code is modified
        - watchexec --watch src --clear just test
  - front_coverage:
      root: ~/elm/survey_tool_elm/front_end
      panes:
        # Uses `just` and `watchexec` to run both
        # elm-verify-examples and elm-coverage (which runs elm-test) when
        # the tests are modified. The src directory is not included here because
        # elm-coverage ends up touching every src file during its
        # instrumentation phase, leading to infinite loops.
        - watchexec --watch tests --ignore tests/elm-package.json --clear just coverage
  - front_console:
      root: ~/elm/survey_tool_elm/front_end
      panes:
        - elm-app repl
  - front_server:
      root: ~/elm/survey_tool_elm/front_end
      panes:
        - elm-app start
  - back_tests:
      root: ~/elm/survey_tool_elm/back_end
      panes:
        - mix test.watch
  - back_server:
      root: ~/elm/survey_tool_elm/back_end
      panes:
        - mix run --no-halt
  - grip: grip
